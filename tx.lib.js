Tx.AjaxCall=function(){var e={url:"",request:"",indicator:new Tx.IndicatorNoop(),messageHandler:new Tx.MessageAlert(),dataType:"json",callback:Tx.nullFunc,processType:"api"},c=function(f){if(!f||typeof(f)!=="object"||Tx.isUndefined(f.payload)||Tx.isUndefined(f.messageList)){f={success:false,payload:[],messageList:[{type:"error",source:"system",text:Tx.I10n.t("Call failed or returned an invalid response.")}]}}return f},b=function(h,g){var f=/#e#[a-zA-Z]+:[0-9]+/,i=function(k){var j=jQuery.type(k),l=k;if(j==="object"){l={};jQuery.each(k,function(n,m){l[n]=i(m)})}else{if(j==="array"){l=[];jQuery.each(k,function(n,m){l.push(i(m))})}else{if(j==="string"&&k.match(f)){l=i(g[k.substr(3)])}}}return l};return i(h)},a=function(f){var h=0,j=[],g=e.messageHandler;if(!Tx.isUndefined(g.reset)){g.reset()}if(f.length>0){for(h;h<f.length;h++){j.push(new Tx.UserMessage(f[h].type,f[h].source,f[h].text))}g.setMessages(j);g.showMessages()}},d=function(g){var f=g;if(e.processType==="api"){f=c(g)}e.indicator.setCallback(function(){if(Tx.inArray(e.processType,["api","apicomplete"])){a(f.messageList);f.payload=b(f.payload,f.entityList);e.callback(e.processType==="api"?f.payload:f)}else{if(e.processType==="raw"){e.callback(f)}}});e.indicator.finish((f.success||e.processType==="raw")?"success":"error")};this.setParam=function(f,g){if(!Tx.isUndefined(e[f])){e[f]=g}};this.getParam=function(f){return(!Tx.isUndefined(e[f]))?e[f]:null};this.doCall=function(){if(e.url===""){throw"URL is missing!"}var g=Tx.CallbackDispatcher.register(d),f=function(i){Tx.CallbackDispatcher.execute(g,i)},h={type:"POST",url:e.url,data:e.request,success:f,error:f,dataType:e.dataType,cache:false};if(e.dataType==="jsonp"){h.type="GET";h.jsonpCallback="jsonpCallback"+g;h.url+=".jsonp"}jQuery.ajax(h);e.indicator.show("loader");return g}};Tx.ApiEndpoints={StationSearch:"StationSearch"};Tx.ApiObjects={StationSearch:{Site:null,name:null,onlyStartStations:false,onlyEndStations:false,StationFrom:null,StationTo:null,Maparea:null,statusList:[1],orderBy:"id"}};Tx.CallbackDispatcher={slotIdCounter:0,slots:{},register:function(){++this.slotIdCounter;this.slots[this.slotIdCounter]={callbacks:arguments};return this.slotIdCounter},execute:function(a,b){var c=this.slots[a];if(c&&!Tx.isUndefined(c.callbacks)){jQuery.each(c.callbacks,function(d,e){if(typeof(e)==="function"){e(b)}})}delete (this.slots[a])}};Tx.Endpoint=function(g,b){var e=b||{},c=(typeof(Tx.ApiEndpoints[g])==="string"),a=c?g:"",f=c?Tx.ApiEndpoints[a]:"",d=new Tx.AjaxCall();if(!c){throw Tx.sprintf("Invalid endpoint: %s",g)}this.execute=function(){var h=d.getParam("request");h+=(h.length?"&":"?")+"locale="+Tx.config.locale;d.setParam("url",Tx.config.apiBase+"/"+a);d.setParam("request",h);d.doCall()};this.setParam=function(h,i){d.setParam(h,i)};this.setRequest=function(h){if(typeof(h)!=="object"||typeof(h.getName)!=="function"){throw"Invalid request object."}else{if(h.getName()!==f){throw Tx.sprintf("Wrong request object, expected %s, got %s",f,h.getName())}}d.setParam("request","request="+JSON.stringify(h).replace(/\+/g,"%2b").replace(/&/g,"%26"))};this.setIndicator=function(h){d.setParam("indicator",h)};this.setMessageHandler=function(h){d.setParam("messageHandler",h)};this.setCallback=function(h){d.setParam("callback",h)};jQuery.each(e,function(h,i){d.setParam(h,i)})};Tx.isNull=function(a){return(a===null)};Tx.isUndefined=function(a){return(a===undefined)};Tx.objectToArray=function(c,a){var b=[];jQuery.each(c,function(d,e){b.push(a&&a==="keys"?d:e)});return b};Tx.getObjectKeys=function(a){return Tx.objectToArray(a,"keys")};Tx.arrayMap=function(c,a){var b=0;for(b;b<a.length;b++){a[b]=c(a[b])}return a};Tx.trim=function(a){if(Tx.isUndefined(a.replace)){a=a.toString()}a=a.replace(/^\s+/,"");a=a.replace(/\s+$/,"");return a};Tx.toInt=function(b){var a;if(typeof(b)==="boolean"){a=b?1:0}else{if(typeof(b)==="string"){b=b.replace(",",".")}a=parseInt(b,10)}if(isNaN(a)){a=0}return a};Tx.toFloat=function(b){if(typeof(b)==="string"){b=b.replace(",",".")}var a=parseFloat(b);if(isNaN(a)){a=0}return a};Tx.toBool=function(a){return !!Tx.toInt(a)};Tx.vsprintf=function(b,a){var c=0;if(!a||!a.length){return b}for(c;c<a.length;c++){b=b.replace(/%s/,a[c])}return b};Tx.sprintf=function(b){var a=[];jQuery.each(arguments,function(d,c){if(d){a.push(c)}});return Tx.vsprintf(b,a)};Tx.stopEvent=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};Tx.currencyFormat=function(c){var b=Math.floor(c),a=c*100-b*100;a=Math.round(a);if(a===0){a="00"}else{if(a<10){a="0"+a}}return b+Tx.I10n.tc(".|decimal separator")+a};Tx.varpad=function(g,c,d){var f=g.toString(),b=c||2,e=d?d.toString():" ",a="";while(f.length<b){f=e+f}return f};Tx.numpad=function(b,a){return Tx.varpad(b,a,"0")};Tx.inArray=function(f,e,d){var c=0,a=d||false,b=false;if(!Tx.isUndefined(e)&&!Tx.isNull(e)){jQuery.each(e,function(g,h){if((a&&f===h)||(!a&&f==h)){b=true;return false}})}return b};Tx.collectFormValues=function(d,a){var b={},c=a||"";jQuery(d).find("input[name], select[name], textarea[name]").each(function(){var g=null,f=jQuery(this),e=f.attr("name");if((c&&e.indexOf(c)!==0)||f.attr("data-ignore")==="true"){return}e=e.substr(c.length);g=f.getFieldValue();if(!Tx.isNull(g)&&!Tx.isUndefined(g)&&!Tx.isNull(e)&&!Tx.isUndefined(e)){if(e.substr(-4,4)==="List"&&!jQuery.isArray(g)){if(!jQuery.isArray(b[e])){b[e]=[]}b[e].push(g)}else{b[e]=g}}});return b};Tx.redirect=function(a){window.location.href=a};Tx.nullFunc=function(){};Tx.appendParams=function(e,a,d){var c=e||"",g=a||{},f=d||"",b="&";if(f==="html"){b="&amp;"}else{if(f==="url"){b="%26"}}jQuery.each(g,function(h,i){c+=(c.indexOf("?")===-1?"?":b)+Tx.sprintf("%s=%s",h,i)});return c};Tx.findObjectInList=function(e,f,b){var c=0,a=null,d=b||"id";for(c;c<e.length;c++){if(e[c][d]==f){a=e[c];break}}return a};Tx.removeObjectFromList=function(e,f,a){var b=0,d=[],c=a||"id";for(b;b<e.length;b++){if(e[b][c]!=f){d.push(e[b])}}return d};Tx.findObjectsInList=function(f,a,b){var d=[],c=0,g,e=b||"id";for(c;c<a.length;c++){g=Tx.findObjectInList(f,a[c],e);if(g&&g[e]){d.push(g)}}return d};Tx.esc=function(a){var b={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#038;"};jQuery.each(b,function(d,c){if(typeof a==="string"){a=a.replace(new RegExp(d,"g"),c)}});return a};Tx.out=function(a){a=Tx.esc(a);if(window.Tx.I10n!==undefined){a=Tx.I10n.mlStringTranslate(a,Tx.config.locale)}return a};Tx.I10n={t:function(a){return(!Tx.isUndefined(window.messages)&&!Tx.isUndefined(window.messages[a]))?window.messages[a]:a},tc:function(a){var b=Tx.I10n.t(a),c=b.lastIndexOf("|");return(c===-1)?b:b.slice(0,c)},tn:function(c,b){var a=Tx.I10n.t(c),d=a.indexOf("|")>0?a.split("|"):[a,a];return b===1?d[0]:d[1]},mlStringToObj:function(a){var b=new RegExp("\\[:(?=[a-z]{2}\\])","g"),c={};if(typeof(a)==="string"){jQuery.each(a.split(b),function(d,f){var g=f.substr(0,2),e=f.substr(3);if(f.length>=3&&f.substr(0,3).match(/[a-z]{2}\]/)){c[g]=e}})}return c},mlStringTranslate:function(c,b){var e=b.substr(0,2),d,a=c;if(typeof(c)==="string"&&c.match(/\[:[a-z]{2}\]/)){d=Tx.I10n.mlStringToObj(c);if(typeof(d[e]==="string")){a=d[e]}}return a}};Tx.IndicatorNoop=function(){var a=Tx.nullFunc;this.setCallback=function(b){a=b};this.show=Tx.nullFunc;this.finish=function(b){a()}};Tx.IndicatorSpinner=function(a){var b=Tx.nullFunc;this.setCallback=function(c){b=c};this.show=function(){a.show()};this.finish=function(c){a.hide();b()}};if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());Tx.MessageAlert=function(){var a=[];this.reset=Tx.nullFunc;this.setMessages=function(b){a=b};this.showMessages=function(){var c=0,b=[],d="";if(a.length===1){d=a[0].getText()}else{for(c;c<a.length;c++){b.push("• "+a[c].getText())}d=b.join("\n")}alert(d)}};Tx.RequestObject=function(b,a){var c;if(Tx.isUndefined(Tx.ApiObjects[b])){throw Tx.sprintf("Object does not exist: %s",b)}c=jQuery.extend(true,{},Tx.ApiObjects[b]);c=jQuery.extend(true,c,new Tx.RequestObjectPrototype());c.setName(b);if(!Tx.isUndefined(a)){jQuery.each(a,function(d,e){c.set(d,e)})}return c};Tx.RequestObjectPrototype=function(){var a="",b=function(d,c){if(Tx.isUndefined(d[c])){throw Tx.sprintf("Object %s does not have a property named %s.",a,c)}};this.set=function(c,d){b(this,c);this[c]=d};this.get=function(c){b(this,c);return this[c]};this.setName=function(c){a=c};this.getName=function(){return a}};Tx.UserMessage=function(b,a,e){var c=b||"info",f=e||"",d=a||"user";this.getType=function(){return c};this.getSource=function(){return d};this.getText=function(){return f}};
